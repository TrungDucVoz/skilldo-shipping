<?php$zone_id    = InputBuilder::get('zone_id');$zone       = shipping::getZone( $zone_id );$locations  = array();foreach ($zone->locations as $value) {    $locations[$value->location_type] = $value;}$states 	= Cart_Location::cities();$districts 	= Cart_Location::districts();$districts_option = array();foreach ($locations as $key =>$location):    foreach ($districts[$key] as $key_districts => $name_districts):        $districts_option[$key.'_'.$key_districts] = $name_districts;    endforeach;endforeach;?><div class="col-md-12">    <input type="hidden" name="zone_id" id="inputZone_id" value="<?php echo $zone_id;?>">    <div class="row tr_group">        <div class="col-md-3">            <label>Tên vùng</label>        </div>        <div class="col-md-8">            <input type="text" name="zone_name" class="form-control" value="<?php echo $zone->zone_name;?>" required="required">        </div>    </div>    <div class="row tr_group">        <div class="col-md-3">            <label>Khu vực</label>        </div>        <div class="col-md-8">            <select class="form-control zone_locations-multiple" name="zone_locations[]" multiple>                <?php foreach ($states as $key => $name): ?>                    <option value="<?php echo $key;?>" <?php echo ( isset( $locations[$key] ) )?'selected=selected':'';?>><?php echo $name;?></option>                <?php endforeach ?>            </select>        </div>    </div>    <div class="row tr_group">        <div class="col-md-3">            <label>Loại hình</label>        </div>        <div class="col-md-8">            <select class="form-control" name="zone_type">                <option value="zone_type_free" <?php echo ( $zone->zone_type == 'zone_type_free' )?'selected=selected':'';?>><?php echo shipping::getZoneType('zone_type_free');?></option>                <option value="zone_type_flat" <?php echo ( $zone->zone_type == 'zone_type_flat' )?'selected=selected':'';?>><?php echo shipping::getZoneType('zone_type_flat');?></option>                <option value="zone_type_district" <?php echo ( $zone->zone_type == 'zone_type_district' )?'selected=selected':'';?>><?php echo shipping::getZoneType('zone_type_district');?></option>            </select>        </div>    </div>    <?php if($zone->zone_type != 'zone_type_free') { ?>        <div class="row tr_group">            <div class="col-md-3">                <label>Phí vận chuyển mặc đinh</label>            </div>            <div class="col-md-8">                <input type="text" name="zone_price" class="form-control" value="<?php echo $zone->zone_price;?>" required="required">            </div>        </div>    <?php } ?>    <?php if(!empty($shipping['range_price']) && $shipping['range_price'] == 'range_price'): ?>        <div class="row tr_group">            <div class="col-md-3">                <label>Khoảng giá</label>            </div>            <div class="col-md-8">                <div class="row">                <?php                $Form = new FormBuilder();                $Form->add('range_zone_price', 'repeater', ['label' => '', 'fields' => [                    ['name' => 'min',   'type' => 'number',  'label' => 'Từ', 'col' => 3,],                    ['name' => 'max',   'type' => 'number', 'label' => 'Đến', 'col' => 3],                    ['name' => 'value', 'type' => 'number', 'label' => 'Phí ship', 'col' => 4,],                ]], (!empty($zone->range_zone_price)) ? unserialize($zone->range_zone_price) : []);                $Form->html(false);                ?>                </div>            </div>        </div>    <?php endif; ?>    <?php if($zone->zone_type == 'zone_type_district') { ?>        <div class="row tr_group">            <div class="col-md-3">                <label>Phí vận chuyển thao quận huyện</label>            </div>            <div class="col-md-8">                <div class="" id="wcmc-shipping-districts">                    <table class="table table-bordered" cellspacing="0">                        <thead>                        <tr>                            <th>Quận/Huyện</th>                            <?php if(!empty($shipping['range_price']) && $shipping['range_price'] == 'range_price') {?>                            <th>Đơn hàng từ</th>                            <th>Đến</th>                            <?php } ?>                            <th>Phí vận chuyển</th>                            <th></th>                        </tr>                        <tr class="" id="shipping-districts-add">                            <td>                                <select class="form-control zone_locations-multiple" name="zone_districts[locations]" multiple>                                    <?php foreach ($districts_option as $key_districts => $name_districts): ?>                                        <option value="<?php echo $key_districts;?>"><?php echo $name_districts;?></option>                                    <?php endforeach ?>                                </select>                            </td>                            <?php if(!empty($shipping['range_price']) && $shipping['range_price'] == 'range_price') {?>                                <td>                                    <input type="number" class="form-control" value="0" name="zone_districts[min]">                                </td>                                <td>                                    <input type="number" class="form-control" value="0" name="zone_districts[max]">                                </td>                            <?php } ?>                            <td>                                <input type="number" class="form-control" value="0" name="zone_districts[price]">                            </td>                            <td class="sort">                                <button class="submit btn-green btn-icon">Thêm</button>                            </td>                        </tr>                        </thead>                        <tbody class="js_shipping_districts__tbody ui-sortable">                            <?php $districts = shipping::getsDistricts( array('where' => array('zone_id' => $zone->id) ) );?>                            <?php foreach ($districts as $key => $value): ?>                                <tr class="js_shipping_districts__item">                                    <td style="width: 200px;">                                        <?php                                        $districts_locations = array();                                        foreach ($value->locations as $location) {                                            $districts_locations[$location->locations_type.'_'.$location->locations_code] = $location;                                        }                                        ?>                                        <select class="form-control zone_locations-multiple" name="zone_districts[<?php echo $value->id;?>][locations]" multiple>                                            <?php foreach ($districts_option as $key_districts => $name_districts): ?>                                                <option value="<?php echo $key_districts;?>" <?php echo ( isset($districts_locations[$key_districts]) )?'selected=selected':'';?>><?php echo $name_districts;?></option>                                            <?php endforeach ?>                                        </select>                                    </td>                                    <?php if(!empty($shipping['range_price']) && $shipping['range_price'] == 'range_price') {?>                                        <td>                                            <input type="number" class="form-control" value="<?php echo $value->districts_price_min;?>" name="zone_districts[<?php echo $value->id;?>][min]">                                        </td>                                        <td>                                            <input type="number" class="form-control" value="<?php echo $value->districts_price_max;?>" name="zone_districts[<?php echo $value->id;?>][max]">                                        </td>                                    <?php } ?>                                    <td>                                        <input type="number" class="form-control" value="<?php echo $value->districts_price;?>" name="zone_districts[<?php echo $value->id;?>][price]">                                    </td>                                    <td class="sort">                                        <button class="js_zone_districts__delete btn-red btn-icon" data-id="<?php echo $value->id;?>">Xóa</button>                                        <button class="js_zone_districts__edit btn-blue btn-icon" data-id="<?php echo $value->id;?>">Lưu</button>                                    </td>                                </tr>                            <?php endforeach ?>                        </tbody>                        <tfoot>                            <tr>                                <th colspan="7">                                </th>                            </tr>                        </tfoot>                    </table>                </div>            </div>        </div>    <?php }?></div><style type="text/css">    table.table tr { border: 1px solid #ccc; }    .tr_group { margin-bottom: 10px; }    .select2-container {        width: 100%!important;    }    .action-bar button {display: none;}</style><script type="text/javascript">    $(document).ready(function() {        $('.zone_locations-multiple').select2();        let zone_dis_add_label = '#shipping-districts-add';        let zone_dis_tbody = $('.js_shipping_districts__tbody');        $(zone_dis_add_label + ' button.submit').click(function() {            let data 		= {                zone_id 				: <?php echo $zone->id;?>,                districts_price 		: $(zone_dis_add_label + ' input[name="zone_districts[price]"]').val(),                districts_price_min 	: $(zone_dis_add_label + ' input[name="zone_districts[min]"]').val(),                districts_price_max 	: $(zone_dis_add_label + ' input[name="zone_districts[max]"]').val(),                districts_locations 	: $(zone_dis_add_label + ' select[name="zone_districts[locations]"]').val(),            };            data.action     =  'admin_shipping_ajax_districts_save';            $.post(ajax, data, function() {}, 'json').done(function(response) {                show_message(response.message, response.status);                if(response.status === 'success') {                    zone_dis_tbody.prepend(response.data);                    $('.zone_locations-multiple').select2();                    $(zone_dis_add_label + ' input[name="zone_districts[price]"]').val('');                    $(zone_dis_add_label + ' input[name="zone_districts[min]"]').val('');                    $(zone_dis_add_label + ' input[name="zone_districts[max]"]').val('');                    $(zone_dis_add_label + ' input[name="zone_districts[locations]"]').val('');                }            });            return false;        });        $('.js_zone_districts__edit').click(function() {            var id = $(this).attr('data-id');            var data 		= {                zone_id 				: <?php echo $zone->id;?>,                districts_id 			: id,                districts_price 		: $('input[name="zone_districts['+id+'][price]"]').val(),                districts_price_min 		: $('input[name="zone_districts['+id+'][min]"]').val(),                districts_price_max 		: $('input[name="zone_districts['+id+'][max]"]').val(),                districts_locations 	: $('select[name="zone_districts['+id+'][locations]"]').val(),            };            data.action     =  'admin_shipping_ajax_districts_save';            $jqxhr   = $.post(ajax, data, function() {}, 'json');            $jqxhr.done(function( data ) {                show_message(data.message, data.type);            });            return false;        });        $('.js_zone_districts__delete').click(function() {            let id = $(this).attr('data-id');            let item = $(this).closest('.js_shipping_districts__item');            let data = {                zone_id         : <?php echo $zone->id;?>,                districts_id    : id,            };            data.action     =  'admin_shipping_ajax_districts_delete';            $.post(ajax, data, function() {}, 'json').done(function(response) {                show_message(response.message, response.status);                if( response.status === 'success' ) item.remove();            });            return false;        });        $('#mainform').submit(function() {            $('#ajax_item_save_loader').show();            var data 		= $(this).serializeJSON();            data.action     =  'admin_shipping_ajax_zone_save';            $jqxhr   = $.post(ajax, data, function() {}, 'json');            $jqxhr.done(function( data ) {                $('#ajax_item_save_loader').hide();                show_message(data.message, data.type);            });            return false;        });    });</script>